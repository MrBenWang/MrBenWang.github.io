<!DOCTYPE html>
<html lang="zh-cn" itemscope itemtype="http://schema.org/WebPage">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>*旧 WCF 项目迁移到 asp.net core &#43; gRPC 的尝试 - 风雪夜归人</title>
  

<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta name="MobileOptimized" content="width"/>
<meta name="HandheldFriendly" content="true"/>


<meta name="applicable-device" content="pc,mobile">

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="mobile-web-app-capable" content="yes">

<meta name="author" content="Long" />
  <meta name="description" content="一个月前，公司的运行WCF的windows服务器down掉了，由于 AWS 没有通知，没有能第一时间发现问题。
所以，客户提出将WCF服务由C#改为JAVA，在Linux上面运行；一方面，AWS对Linux有较多的监控措施，另一方面，假如出现问题，可以设置自动重启等服务。
" />

  <meta name="keywords" content="个人博客, 有趣, 编程, 生活" />



<meta name="google-site-verification" content="hqw-Lg4woniVGx2b2LZ25xQDQsh_da1VWm_nhza2aZg" />


<meta name="generator" content="Hugo 0.74.3" />


<link rel="canonical" href="https://mrbenwang.github.io/post/2020/20200813-wcf-to-aspnetcore-grpc/" />





<link rel="icon" href="/favicon.ico" />











<link rel="stylesheet" href="/sass/jane.min.b3a8813c06e6d785beba22bf8264e174fa2cb3a396b22f9ba24e2c00c18aaf7f.css" integrity="sha256-s6iBPAbm14W&#43;uiK/gmThdPoss6OWsi&#43;bok4sAMGKr38=" media="screen" crossorigin="anonymous">




<link rel="stylesheet" href="/css/custom.css">


<meta property="og:title" content="*旧 WCF 项目迁移到 asp.net core &#43; gRPC 的尝试" />
<meta property="og:description" content="一个月前，公司的运行WCF的windows服务器down掉了，由于 AWS 没有通知，没有能第一时间发现问题。
所以，客户提出将WCF服务由C#改为JAVA，在Linux上面运行；一方面，AWS对Linux有较多的监控措施，另一方面，假如出现问题，可以设置自动重启等服务。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://mrbenwang.github.io/post/2020/20200813-wcf-to-aspnetcore-grpc/" />
<meta property="article:published_time" content="2020-08-13T11:11:00+08:00" />
<meta property="article:modified_time" content="2020-08-13T19:11:00+08:00" />
<meta itemprop="name" content="*旧 WCF 项目迁移到 asp.net core &#43; gRPC 的尝试">
<meta itemprop="description" content="一个月前，公司的运行WCF的windows服务器down掉了，由于 AWS 没有通知，没有能第一时间发现问题。
所以，客户提出将WCF服务由C#改为JAVA，在Linux上面运行；一方面，AWS对Linux有较多的监控措施，另一方面，假如出现问题，可以设置自动重启等服务。">
<meta itemprop="datePublished" content="2020-08-13T11:11:00+08:00" />
<meta itemprop="dateModified" content="2020-08-13T19:11:00+08:00" />
<meta itemprop="wordCount" content="3981">



<meta itemprop="keywords" content="net core,gRPC," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="*旧 WCF 项目迁移到 asp.net core &#43; gRPC 的尝试"/>
<meta name="twitter:description" content="一个月前，公司的运行WCF的windows服务器down掉了，由于 AWS 没有通知，没有能第一时间发现问题。
所以，客户提出将WCF服务由C#改为JAVA，在Linux上面运行；一方面，AWS对Linux有较多的监控措施，另一方面，假如出现问题，可以设置自动重启等服务。"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-130619472-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>



</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">风雪夜归人</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://mrbenwang.github.io/">主页</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://mrbenwang.github.io/post/">全部文章</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://mrbenwang.github.io/tags/">标签</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://mrbenwang.github.io/categories/">分类</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://mrbenwang.github.io/about/">关于</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          <div class="mobile-menu-parent">
            <span class="mobile-submenu-open"></span>
            <a href="https://mrbenwang.github.io/">
              逻辑谬误
            </a>
          </div>
          <ul class="mobile-submenu-list">
            
              <li>
                <a href="https://mrbenwang.github.io/post/2018/20181207-logical-fallacy-list-foreword/">[转]逻辑谬误列表(序言)</a>
              </li>
            
              <li>
                <a href="https://mrbenwang.github.io/post/2018/20181207-logical-fallacy-list-1/">[转]逻辑谬误列表(1-12)</a>
              </li>
            
              <li>
                <a href="https://mrbenwang.github.io/post/2018/20181207-logical-fallacy-list-2/">[转]逻辑谬误列表(13-24)</a>
              </li>
            
              <li>
                <a href="https://mrbenwang.github.io/post/2018/20181207-logical-fallacy-list-ex/">[转]逻辑谬误列表(例子)</a>
              </li>
            
          </ul>
        
      </li>
    

    
      <li class="mobile-menu-item">
        <a id="openSearchMobile" class="mobile-menu-item-link menu-item-search" href="#">
          <i class="iconfont">
            <svg version="1.1" viewBox="0 0 1024 1024"
  xmlns="http://www.w3.org/2000/svg" width="18" height="18"
  xmlns:xlink="http://www.w3.org/1999/xlink">
  <path d="M973.81454219 973.81454219a91.78207815 91.78207815 0 0 1-129.80999631 0l-161.97482118-161.97482118a425.48527711 425.48527711 0 0 1-230.35931791 68.16531768 428.3346319 428.3346319 0 1 1 428.3346319-428.3346319 425.48527711 425.48527711 0 0 1-68.16531768 230.35931791l162.02961656 161.97482118a91.83687354 91.83687354 0 0 1-0.05479538 129.80999631zM451.67040679 145.69361559a305.97679241 305.97679241 0 1 0 0 611.95358361 305.97679241 305.97679241 0 0 0 0-611.95358361z">
  </path>
</svg>

          </i>
        </a>
      </li>
    
  </ul>
</nav>


  
    






  <link rel="stylesheet" href="/lib/photoswipe/photoswipe.min.css" />
  <link rel="stylesheet" href="/lib/photoswipe/default-skin/default-skin.min.css" />




<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>

  

  
    
<div class="modal-dialog">
    
    <div class="modal-content">
      <div id="closeSearch" title="Close" class="close">X</div>
      <div class="modal-header">
        <div class="modal-title">Search</div>
      </div>
      <div class="modal-body">
          <script>
            (function() {
              var cx = '015982908853339398897:duxagwzp5jn';
              var gcse = document.createElement('script');
              gcse.type = 'text/javascript';
              gcse.async = true;
              gcse.src = (document.location.protocol == 'https:' ? 'https:' :
                  'http:') +
                '//cse.google.com/cse.js?cx=' + cx;
              var s = document.getElementsByTagName('script')[0];
              s.parentNode.insertBefore(gcse, s);
            })();
          </script>
          <gcse:search></gcse:search>
      </div>
    </div>
</div>

  

  

  <header id="header" class="header container">
    <div class="logo-wrapper">
  <a href="/" class="logo">
    
      风雪夜归人
    
  </a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://mrbenwang.github.io/">主页</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://mrbenwang.github.io/post/">全部文章</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://mrbenwang.github.io/tags/">标签</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://mrbenwang.github.io/categories/">分类</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://mrbenwang.github.io/about/">关于</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          <a class="menu-item-link menu-parent" href="https://mrbenwang.github.io/">逻辑谬误</a>
          <ul class="submenu">
            
              <li>
                <a href="https://mrbenwang.github.io/post/2018/20181207-logical-fallacy-list-foreword/">[转]逻辑谬误列表(序言)</a>
              </li>
            
              <li>
                <a href="https://mrbenwang.github.io/post/2018/20181207-logical-fallacy-list-1/">[转]逻辑谬误列表(1-12)</a>
              </li>
            
              <li>
                <a href="https://mrbenwang.github.io/post/2018/20181207-logical-fallacy-list-2/">[转]逻辑谬误列表(13-24)</a>
              </li>
            
              <li>
                <a href="https://mrbenwang.github.io/post/2018/20181207-logical-fallacy-list-ex/">[转]逻辑谬误列表(例子)</a>
              </li>
            
          </ul>

        

      </li>
    

    
    

    
      <li class="menu-item">
        <a id="openSearch" class="menu-item-link menu-item-search" href="#">
          <i class="iconfont">
            <svg version="1.1" viewBox="0 0 1024 1024"
  xmlns="http://www.w3.org/2000/svg" width="18" height="18"
  xmlns:xlink="http://www.w3.org/1999/xlink">
  <path d="M973.81454219 973.81454219a91.78207815 91.78207815 0 0 1-129.80999631 0l-161.97482118-161.97482118a425.48527711 425.48527711 0 0 1-230.35931791 68.16531768 428.3346319 428.3346319 0 1 1 428.3346319-428.3346319 425.48527711 425.48527711 0 0 1-68.16531768 230.35931791l162.02961656 161.97482118a91.83687354 91.83687354 0 0 1-0.05479538 129.80999631zM451.67040679 145.69361559a305.97679241 305.97679241 0 1 0 0 611.95358361 305.97679241 305.97679241 0 0 0 0-611.95358361z">
  </path>
</svg>

          </i>
        </a>
      </li>
    
  </ul>
</nav>

  </header>

  <div id="mobile-panel">
    <main id="main" class="main bg-llight">
      <div class="content-wrapper">
        <div id="content" class="content container">
          <article class="post bg-white">
    
    <header class="post-header">
      <h1 class="post-title">*旧 WCF 项目迁移到 asp.net core &#43; gRPC 的尝试</h1>
      
      <div class="post-meta">
        <time datetime="2020-08-13" class="post-time">
          2020-08-13 11:11
        </time>
        <div class="post-category">
            <a href="https://mrbenwang.github.io/categories/%E5%B7%A5%E4%BD%9C%E9%9A%8F%E7%AC%94/"> 工作随笔 </a>
            
          </div>
        <span class="more-meta"> 约 3981 字 </span>
          <span class="more-meta"> 预计阅读 8 分钟 </span>

        
        

        
        
      </div>
    </header>

    
    
<div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#老旧的wcf服务">老旧的WCF服务</a></li>
    <li><a href="#了解grpc">了解gRPC</a>
      <ul>
        <li><a href="#grpc-的-proto-文件">gRPC 的 proto 文件</a></li>
        <li><a href="#根据-proto-生成代码">根据 proto 生成代码</a></li>
      </ul>
    </li>
    <li><a href="#aspnet-core-31">asp.net core 3.1</a></li>
    <li><a href="#entity-framework-core">Entity Framework Core</a></li>
    <li><a href="#部署到-ubuntu">部署到 Ubuntu</a></li>
    <li><a href="#客户端的编写">客户端的编写</a></li>
    <li><a href="#总结">总结</a></li>
  </ul>
</nav>
  </div>
</div>

    
    <div class="post-content">
      <p>一个月前，公司的运行WCF的windows服务器down掉了，由于 AWS 没有通知，没有能<strong>第一时间</strong>发现问题。<br>
所以，客户提出将WCF服务由C#改为JAVA，在Linux上面运行；一方面，AWS对Linux有较多的监控措施，另一方面，假如出现问题，可以设置自动重启等服务。</p>
<h2 id="老旧的wcf服务">老旧的WCF服务</h2>
<p>目前WCF服务，主要提供windows桌面软件的<strong>数据接口</strong>，应该有五六年的历史了。我进入公司后，WCF服务的代码，一直由我一个人来维护。存在很多<strong>历史遗留问题</strong>，也有<strong>不同版本</strong>的共存。</p>
<p>如果java重写的话，其中的业务逻辑代码，难免会出现各种各样的bug，增加开发和测试的工作量。听说，要移植到linux服务上后，第一时间想到的就是<strong>跨平台</strong>的 <code>.net core</code> 。<br>
.net core 经过了四年的发展，到目前的 3.1 LST版本，已经是<strong>非常成熟</strong>的跨平台解决方案了。</p>
<p>之后，我就在网上查找，有没有WCF的.net core 版本，查询到的信息总结如下：</p>
<ol>
<li>Core WCF不打算做WCF到.NET Core的100％兼容的移植；</li>
<li>对于新应用程序，WCF这种SOAP技术不建议使用；</li>
<li>对于老的应用程序，建议将这些保留在.NET Framework上；</li>
<li>如果您真的想将一个旧的应用程序迁移到.NET Core并且想继续使用WCF和WF， 社区的开源项目也是可以的，但是上生产的时间表就要到了2020年.NET 5；</li>
<li>开源社区，也强烈建议目前不要用于生产环境。</li>
</ol>
<p>很遗憾，想不改动代码就迁移到 Linux 上面，基本是不可能的了。<br>
我的最理想情况，<strong>尽量少的手写代码</strong>，最好可以像WCF一样，<strong>自动生成</strong>代理类，<strong>像访问本地代码</strong>一样，来调用接口。之后，就发现了asp.net core + gRPC这种形式。</p>
<h2 id="了解grpc">了解gRPC</h2>
<p>gRPC 的好处非常多：<code>高性能</code>，<code>传输数据小</code>，支持<code>多语言</code>的<strong>生成工具</strong>，<code>使用HTTP2协议</code>，这些好处网上都有大量详细的介绍，本文不做赘述。<br>
其实我最看重的部分还是：客户端和服务端代码，都可以通过一个 <code>proto</code> 协议文件来<strong>自动生成</strong>。</p>
<p>而微软官方，也建议用 ASP.NET Core gRPC。 <a href="https://docs.microsoft.com/zh-cn/dotnet/architecture/grpc-for-wcf-developers/">《适用于 WCF 开发人员的 ASP.NET Core gRPC》</a></p>
<h3 id="grpc-的-proto-文件">gRPC 的 proto 文件</h3>
<p>为了了解 proto 文件的写法，硬着头皮看谷歌英文文档， proto3 勉强了解大概。<a href="https://developers.google.com/protocol-buffers/docs/proto3">《Language Guide (proto3)》</a>，下面列出一些，我在使用过程中的经验总结：</p>
<ol>
<li>一个RPC服务必须<strong>有且仅有</strong><code>一个入参</code>和<code>一个出参</code>；假如不需要的话，可以设置为空的对象<code>google.protobuf.Empty</code>；</li>
<li><strong>基本类型</strong>( string, int32 等)<strong>不能作为PRC服务的参数</strong>，可使用谷歌提供的封装对象，如：<code>google.protobuf.StringValue</code>，<code>google.protobuf.Int32Value</code> 详见 <code>google/protobuf/wrappers.proto</code>文件；</li>
<li>proto3 <strong>不允许null值</strong>，这是由于 Protobuf 二进制序列化，<strong>空和null不能区分</strong>，利用<code>google.protobuf.StringValue</code> 则可以实现null值；同第2点；</li>
<li><code>string name=1;</code>这个数字必须写，用作 Protobuf 二进制序列化，并且常用的属性最好放在前12；PS: 太不习惯了，总以为是在赋值操作；</li>
<li>枚举类型必须从0开始，即：<code>enum Weekday {Sunday=0;Monday=2;}</code>；</li>
<li>时间类型<code>google.protobuf.Timestamp</code>，必须是 UTC 时间；</li>
<li>消息体 message 不能继承，可多层嵌套，可以导入 import；</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-proto" data-lang="proto"><span class="c1">// 我的例子
</span><span class="c1"></span><span class="n">syntax</span> <span class="o">=</span> <span class="s">&#34;proto3&#34;</span><span class="p">;</span><span class="err">
</span><span class="err">
</span><span class="err"></span><span class="k">option</span> <span class="n">csharp_namespace</span> <span class="o">=</span> <span class="s">&#34;GrpcServiceTest.Protos&#34;</span><span class="p">;</span><span class="err">
</span><span class="err">
</span><span class="err"></span><span class="k">import</span> <span class="s">&#34;Protos/ClientInfoModel.proto&#34;</span><span class="p">;</span><span class="err">
</span><span class="err"></span><span class="k">import</span> <span class="s">&#34;google/protobuf/timestamp.proto&#34;</span><span class="p">;</span><span class="err">
</span><span class="err"></span><span class="k">import</span> <span class="s">&#34;google/protobuf/wrappers.proto&#34;</span><span class="p">;</span><span class="err">
</span><span class="err">
</span><span class="err"></span><span class="kn">package</span> <span class="nn">UserManagement</span><span class="p">;</span><span class="err">
</span><span class="err"></span><span class="kd">service</span> <span class="n">UserManagement</span> <span class="p">{</span><span class="err">
</span><span class="err"></span>    <span class="k">rpc</span> <span class="n">UserReset</span><span class="p">(</span><span class="n">google.protobuf.Empty</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="n">google.protobuf.Empty</span><span class="p">);</span><span class="err">
</span><span class="err"></span>    <span class="k">rpc</span> <span class="n">UserLogin</span><span class="p">(</span><span class="n">LoginRequestV2</span><span class="p">)</span> <span class="k">returns</span><span class="p">(</span><span class="n">LoginResponseV2</span><span class="p">);</span><span class="err">
</span><span class="err"></span><span class="p">}</span><span class="err">
</span><span class="err">
</span><span class="err"></span><span class="kd">message</span> <span class="nc">LoginRequestV2</span> <span class="p">{</span><span class="err">
</span><span class="err"></span>    <span class="kt">string</span> <span class="n">UserName</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span><span class="err">
</span><span class="err"></span>    <span class="kt">string</span> <span class="n">Password</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span><span class="err">
</span><span class="err"></span><span class="p">}</span><span class="err">
</span><span class="err">
</span><span class="err"></span><span class="kd">message</span> <span class="nc">LoginResponseV2</span> <span class="p">{</span><span class="err">
</span><span class="err"></span>    <span class="kt">int32</span> <span class="n">TAG</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span><span class="err">
</span><span class="err"></span>    <span class="kt">string</span> <span class="n">Message</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span><span class="err">
</span><span class="err"></span>    <span class="n">UserModelV2</span> <span class="n">UserInfo</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span><span class="err">
</span><span class="err">
</span><span class="err"></span>    <span class="kd">message</span> <span class="nc">UserModelV2</span> <span class="p">{</span><span class="err">
</span><span class="err"></span>        <span class="kt">int64</span> <span class="n">UserID</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span><span class="err">
</span><span class="err"></span>        <span class="kt">string</span> <span class="n">UserName</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span><span class="err">
</span><span class="err"></span>        <span class="n">google.protobuf.StringValue</span> <span class="n">Address</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span><span class="err">
</span><span class="err"></span>        <span class="n">google.protobuf.Timestamp</span> <span class="n">LastLoginTime</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span><span class="err">
</span><span class="err"></span>        <span class="k">repeated</span> <span class="n">PrivGroupPluginModelV2</span> <span class="n">PrivGroupPlugins</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span><span class="err">
</span><span class="err"></span>        <span class="kt">bool</span> <span class="n">IsDeleted</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span><span class="err">
</span><span class="err">
</span><span class="err"></span>        <span class="kd">message</span> <span class="nc">PrivGroupPluginModelV2</span><span class="p">{</span><span class="err">
</span><span class="err"></span>        <span class="kt">int64</span> <span class="n">Id</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="err">
</span><span class="err"></span>        <span class="n">google.protobuf.Timestamp</span> <span class="n">CreateDateTime</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span><span class="err">
</span><span class="err"></span>        <span class="n">google.protobuf.Timestamp</span> <span class="n">ModifyDateTime</span><span class="o">=</span><span class="mi">3</span><span class="p">;</span><span class="err">
</span><span class="err"></span>        <span class="kt">int64</span> <span class="n">PluginId</span><span class="o">=</span><span class="mi">4</span><span class="p">;</span><span class="err">
</span><span class="err"></span>        <span class="kt">int64</span> <span class="n">PrivGroupPluginID</span><span class="o">=</span><span class="mi">5</span><span class="p">;</span><span class="err">
</span><span class="err"></span>        <span class="p">}</span><span class="err">
</span><span class="err"></span>    <span class="p">}</span><span class="err">
</span><span class="err"></span><span class="p">}</span><span class="err">
</span></code></pre></td></tr></table>
</div>
</div><h3 id="根据-proto-生成代码">根据 proto 生成代码</h3>
<p>用vs2019，选择<code>gRPC Service</code>项目模板，创建项目。它会自动加上nuget包<code>Grpc.AspNetCore</code>。如果没有的话，则需要自己安装nuget包：<code>Grpc.core</code>、<code>Google.Protobuf</code>、<code>Grpc.Tools</code>。<br>
由 proto 文件生成代码有两种方式：</p>
<ol>
<li>通过vs右键 proto文件，选择 属性<code>Property</code>，选择<code>Build Action</code>中的<code>Protobuf complier</code>，会看到 <code>gRPC Stub Classes</code>，有三个选项 Server Only ， Clent Only 和 Both 按需选择；<br>
<img src="/images/2020/20200813-wcf-to-aspnetcore-grpc/01-vs-general-proto.jpg" alt="VS生成"></li>
<li>编辑项目文件 csproj，编辑 Protobuf 属性，这种方法还可以使用<code>路径宏</code>，<code>通配符</code>等，相当方便，<strong>强烈推荐</strong>。</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;ItemGroup&gt;</span>
    <span class="nt">&lt;Protobuf</span> <span class="na">Include=</span><span class="s">&#34;Protos/*.proto&#34;</span> <span class="na">OutputDir=</span><span class="s">&#34;%(ProjectDir)ServerGrpc&#34;</span> <span class="na">GrpcServices=</span><span class="s">&#34;Server&#34;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/ItemGroup&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p><img src="/images/2020/20200813-wcf-to-aspnetcore-grpc/02-vs-general-show.jpg" alt="VS生成"></p>
<h2 id="aspnet-core-31">asp.net core 3.1</h2>
<p>现在，恰好赶上了net core 3.1的这个 <strong>LST版本</strong> ( long-term-support )的发布，而 NET Core 3.0 生命周期终结于 2020年3月3日，下个大一统版本 NET 5 ，正式版本还要等到明年。至于为什么没有 NET 4.0版本，官方解释，为了避免于 .NET Framework 4.X 产生歧义。</p>
<p>一步步的按照官方文档的指引，跟着做就可以了。<a href="https://docs.microsoft.com/zh-cn/aspnet/core/grpc/aspnetcore?view=aspnetcore-3.1&amp;tabs=visual-studio">《使用 ASP.NET Core 的 gRPC 服务》</a>，<a href="https://docs.microsoft.com/zh-cn/aspnet/core/tutorials/grpc/grpc-start?view=aspnetcore-3.1&amp;tabs=visual-studio">《教程：在 ASP.NET Core 中创建 gRPC 客户端和服务器》</a></p>
<p>仔细回想了一下，这部分确实没有什么值得说的，<strong>官方文档已经非常的详细了</strong>。唯一不同的感受就是，net core 需要什么功能的话，需要通过nuget来安装；这点与 net framework 大有不同，framework 更像是，一次帮你全部装好。</p>
<h2 id="entity-framework-core">Entity Framework Core</h2>
<p>旧的WCF项目，数据库访问使用的是 Entity Framework + Linq + MySql。需要安装的 Nuget 包：</p>
<ul>
<li><code>MySql.Data.EntityFrameworkCore</code> Mysql的EF核心库；</li>
<li><code>Microsoft.EntityFrameworkCore.Proxies</code> <a href="https://docs.microsoft.com/en-us/ef/core/querying/related-data#lazy-loading">《Lazy loading》</a> 懒加载的插件；</li>
<li><code>Microsoft.EntityFrameworkCore.Design</code> 和 <code>Microsoft.EntityFrameworkCore.Tools</code> 这两个插件，用于生成代码；</li>
</ul>
<p>另外，还需要下载安装 <a href="https://dev.mysql.com/downloads/connector/net/">mysql-connector-net-8.0.21.msi</a> 来访问数据库。其中有一个 <code>Scaffold-DbContext</code> 的<a href="https://bugs.mysql.com/bug.php?id=99419">bug 99419</a> TINYINT(1) 转化为 byte，而不是预期的 bool。这个问题将会在 8.0.22 版本中修复，目前只能手动修改。<br>
EF当然是 <code>Database First</code> 了，生成EF代码需要在<code>Package Manager Console</code>用到 <a href="https://docs.microsoft.com/en-us/ef/core/miscellaneous/cli/powershell#scaffold-dbcontext">Scaffold-DbContext</a> 命令，有三点需要注意：</p>
<ul>
<li><code>Start up</code> 启始项目一定要是引用它的项目，并且编译成功的；</li>
<li><code>Default project</code> 生成后，代码存放的项目；</li>
<li>如果生成失败，提示：“Your startup project &lsquo;XXXX&rsquo; doesn&rsquo;t reference Microsoft.EntityFrameworkCore.Design. This package is required for the Entity Framework Core Tools to work. Ensure your startup project is correct, install the package, and try again.”。编辑项目文件 csproj 移除 <code>&lt;PrivateAssets&gt;All&lt;/PrivateAssets&gt;</code> 从 &ldquo;Microsoft.EntityFrameworkCore.Design&quot;和&quot;Microsoft.EntityFrameworkCore.Tools&quot;中；</li>
</ul>
<p><img src="/images/2020/20200813-wcf-to-aspnetcore-grpc/03-ef-general-code-edit-csproj.jpg" alt="EF remove PrivateAssets"></p>
<p>我的命令： <code>Scaffold-DbContext -Connection &quot;server=10.50.40.50;port=3306;user=myuser;password=123456;database=dbname&quot; -Provider MySql.Data.EntityFrameworkCore -OutputDir &quot;EFModel&quot; -ContextDir &quot;Context&quot; -Project &quot;DataAccess&quot; -Context &quot;BaseEntities&quot; -UseDatabaseNames -Force</code></p>
<p>其他建议：</p>
<ul>
<li>Library类库最好是 <code>Net Standard</code> 方便移植；</li>
<li>新建一个类来继承<code>BaseEntities</code>，覆盖 <code>OnConfiguring</code> 方法，可配置的数据库连接字符串；</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">class</span> <span class="nc">Entities</span> <span class="p">:</span> <span class="n">BaseEntities</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="k">static</span> <span class="kt">string</span> <span class="n">_lstDBString</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="n">SetDefaultDBString</span><span class="p">(</span><span class="kt">string</span> <span class="n">_dbString</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="kt">string</span><span class="p">.</span><span class="n">IsNullOrEmpty</span><span class="p">(</span><span class="n">_lstDBString</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="n">_lstDBString</span> <span class="p">=</span> <span class="n">_dbString</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="n">OnConfiguring</span><span class="p">(</span><span class="n">DbContextOptionsBuilder</span> <span class="n">optionsBuilder</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(!</span><span class="n">optionsBuilder</span><span class="p">.</span><span class="n">IsConfigured</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">optionsBuilder</span><span class="p">.</span><span class="n">UseLazyLoadingProxies</span><span class="p">().</span><span class="n">UseMySQL</span><span class="p">(</span><span class="n">_lstDBString</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>最好采用 asp.net core 的框架注入；鉴于项目的原因，假如强行采用的话，改动比较大，只好放弃；</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">void</span> <span class="n">ConfigureServices</span><span class="p">(</span><span class="n">IServiceCollection</span> <span class="n">services</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">string</span> <span class="n">_dbString</span> <span class="p">=</span> <span class="n">Configuration</span><span class="p">.</span><span class="n">GetConnectionString</span><span class="p">(</span><span class="s">&#34;MyDatabase&#34;</span><span class="p">);</span>
    <span class="n">services</span><span class="p">.</span><span class="n">AddDbContext</span><span class="p">&lt;</span><span class="n">DataAccess</span><span class="p">.</span><span class="n">Context</span><span class="p">.</span><span class="n">Entities</span><span class="p">&gt;(</span>
        <span class="n">options</span> <span class="p">=&gt;</span> <span class="n">options</span><span class="p">.</span><span class="n">UseLazyLoadingProxies</span><span class="p">().</span><span class="n">UseMySQL</span><span class="p">(</span><span class="n">_dbString</span><span class="p">));</span>
    <span class="n">services</span><span class="p">.</span><span class="n">AddGrpc</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>数据库链接字符串有多种存放的方式，有更加安全的方式<a href="https://docs.microsoft.com/zh-cn/aspnet/core/security/app-secrets?view=aspnetcore-3.1&amp;tabs=windows#environment-variables">《ASP.NET Core 中的开发中安全存储应用机密》</a>；而我采用简单方式，存放在 <code>appsettings.json</code>；</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
    <span class="nt">&#34;ConnectionStrings&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;MyDatabase&#34;</span><span class="p">:</span> <span class="s2">&#34;server=127.0.0.1;port=3306;user=myuser;password=123456;database=dbname&#34;</span>
    <span class="p">},</span>
    <span class="nt">&#34;log4net&#34;</span><span class="p">:</span> <span class="s2">&#34;log4net.config&#34;</span><span class="p">,</span>
    <span class="nt">&#34;Logging&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;LogLevel&#34;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&#34;Default&#34;</span><span class="p">:</span> <span class="s2">&#34;Information&#34;</span><span class="p">,</span>
            <span class="nt">&#34;Microsoft&#34;</span><span class="p">:</span> <span class="s2">&#34;Warning&#34;</span><span class="p">,</span>
            <span class="nt">&#34;Microsoft.Hosting.Lifetime&#34;</span><span class="p">:</span> <span class="s2">&#34;Information&#34;</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="nt">&#34;AllowedHosts&#34;</span><span class="p">:</span> <span class="s2">&#34;*&#34;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="部署到-ubuntu">部署到 Ubuntu</h2>
<p>生产环境运行的服务器是 <code>Ubuntu 14.04.6 LTS</code>，在<a href="https://wiki.ubuntu.com/Releases">《ubuntu Releases wiki》</a>上描述，14版本在去年已经停止了标准支持，而 .net core 的 runtime 最低支持也是 <code>Ubuntu 16.04.6 LTS</code>，只好选择最新的版本<code>Ubuntu 20.04.1 LTS</code>。</p>
<p>安装Ubuntu Server系统小插曲：IT支持部门的同事，帮忙<strong>重装了两遍系统</strong>，一次14.04桌面版，一次20.04服务器版；安装20版本后，发现<strong>网卡没有启用</strong>，主机后面网线的灯都没有亮起来。<br>
由于我和他都不熟悉Ubuntu系统，网上查找办法，然后用手机拍照，再来服务器上尝试，搞了好一会儿，才连上网络，SSH也居然没有启用😥。可能 Ubuntu 还是比较适合做桌面系统吧。</p>
<p>然后参考 <a href="https://docs.microsoft.com/zh-cn/dotnet/core/install/linux-ubuntu">《在 Ubuntu 上安装 .NET Core SDK 或 .NET Core 运行时》</a>，安装 net core的环境，最初用的是 <code>aspnetcore-runtime</code> ，在测试的时候发现，gRPC需要 HTTPS。折腾了半天的 HTTPS，一会儿需要签名，一会儿还要生成密钥，一会儿还要放到指定的位置，可信任的证书还要去还要折腾😓😵。折腾了半天，<strong>脑壳一团浆糊</strong>。只好又安装了 <code>dotnet-sdk</code>，这个是自带开发的证书，反正是将就用把。</p>
<p>剩下的就比较简单了，编译发布asp.net core，打包上传到服务器，然后运行<code>dotnet GrpcServiceLST.dll --urls &quot;http://*:5000;http://*:5001&quot;</code>。打开浏览器测试访问，没毛病。</p>
<h2 id="客户端的编写">客户端的编写</h2>
<p>在编写windows客户端的时候，遇到个问题：<a href="https://docs.microsoft.com/zh-cn/aspnet/core/grpc/clientfactory?view=aspnetcore-3.1">《.NET Core 中的 gRPC 客户端工厂集成》</a>推荐的插件 <code>Grpc.Net.ClientFactory</code> 只能适用于 net core，而大部分客户的 windows7 系统不会安装 net core；如果想在 net framework 上使用 gRPC的话，只能<strong>用原生的方法来自己实现</strong>。</p>
<p>使用 proto 文件生成代码的方法，与上面的一致，只需要把 <code>Server Only</code> 改为 <code>Client Only</code> ；代码部分要注意，部署的 HTTPS 是不受信任的，需要额外处理一下。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-csharp" data-lang="csharp"><span class="c1">/// net core 3.1
</span><span class="c1"></span><span class="k">private</span> <span class="k">void</span> <span class="n">button2_Click</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">EventArgs</span> <span class="n">e</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// 取消不受信任
</span><span class="c1"></span>    <span class="kt">var</span> <span class="n">httpHandler</span> <span class="p">=</span> <span class="k">new</span> <span class="n">HttpClientHandler</span><span class="p">();</span>
    <span class="n">httpHandler</span><span class="p">.</span><span class="n">ServerCertificateCustomValidationCallback</span> <span class="p">=</span> <span class="n">HttpClientHandler</span><span class="p">.</span><span class="n">DangerousAcceptAnyServerCertificateValidator</span><span class="p">;</span>
    <span class="kt">var</span> <span class="n">channel</span> <span class="p">=</span> <span class="n">GrpcChannel</span><span class="p">.</span><span class="n">ForAddress</span><span class="p">(</span><span class="s">&#34;https://10.50.40.237:5001&#34;</span><span class="p">,</span> <span class="k">new</span> <span class="n">GrpcChannelOptions</span> <span class="p">{</span> <span class="n">HttpHandler</span> <span class="p">=</span> <span class="n">httpHandler</span> <span class="p">});</span>
    <span class="kt">var</span> <span class="n">client</span> <span class="p">=</span> <span class="k">new</span> <span class="n">UserManagement</span><span class="p">.</span><span class="n">UserManagementClient</span><span class="p">(</span><span class="n">channel</span><span class="p">);</span>
    <span class="kt">var</span> <span class="n">_param</span> <span class="p">=</span> <span class="k">new</span> <span class="n">GrpcServiceLST</span><span class="p">.</span><span class="n">Protos</span><span class="p">.</span><span class="n">LoginRequestV2</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">UserName</span> <span class="p">=</span> <span class="s">&#34;user&#34;</span><span class="p">,</span>
        <span class="n">Password</span> <span class="p">=</span> <span class="s">&#34;123456&#34;</span>
    <span class="p">};</span>
    <span class="kt">var</span> <span class="n">reply</span> <span class="p">=</span> <span class="n">client</span><span class="p">.</span><span class="n">UserLoginOSDShadowEx</span><span class="p">(</span><span class="n">_param</span><span class="p">);</span>
    <span class="n">MessageBox</span><span class="p">.</span><span class="n">Show</span><span class="p">(</span><span class="s">&#34;net core login: &#34;</span> <span class="p">+</span> <span class="n">reply</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">/// framework 4.0
</span><span class="c1"></span><span class="k">private</span> <span class="k">void</span> <span class="n">button1_Click</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">EventArgs</span> <span class="n">e</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">channel</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Channel</span><span class="p">(</span><span class="s">&#34;10.50.40.237:5000&#34;</span><span class="p">,</span> <span class="n">ChannelCredentials</span><span class="p">.</span><span class="n">Insecure</span><span class="p">);</span>
    <span class="kt">var</span> <span class="n">client</span> <span class="p">=</span> <span class="k">new</span> <span class="n">UserManagement</span><span class="p">.</span><span class="n">UserManagementClient</span><span class="p">(</span><span class="n">channel</span><span class="p">);</span>
    <span class="kt">var</span> <span class="n">_param</span> <span class="p">=</span> <span class="k">new</span> <span class="n">GrpcServiceLST</span><span class="p">.</span><span class="n">Protos</span><span class="p">.</span><span class="n">LoginRequestV2</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">UserName</span> <span class="p">=</span> <span class="s">&#34;user&#34;</span><span class="p">,</span>
        <span class="n">Password</span> <span class="p">=</span> <span class="s">&#34;123456&#34;</span>
    <span class="p">};</span>
    <span class="kt">var</span> <span class="n">_reply</span> <span class="p">=</span> <span class="n">client</span><span class="p">.</span><span class="n">UserLoginOSDShadowEx</span><span class="p">(</span><span class="n">_param</span><span class="p">);</span>
    <span class="n">MessageBox</span><span class="p">.</span><span class="n">Show</span><span class="p">(</span><span class="s">&#34;framework login:&#34;</span> <span class="p">+</span> <span class="n">_reply</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>经过测试发现，net core 的gRPC桌面程序 <strong>不支持 http 的访问</strong>； net framework 的桌面程序使用gRPC原生版本，只能访问 http 端口 5000 ，<strong>不能访问 https 端口 5001</strong> ，不能用 http 或者 https 这样的前缀(如: <code>http://10.50.40.237:5000</code>)，<strong>localhost这种域名也无法解析</strong>。</p>
<table>
<thead>
<tr>
<th></th>
<th>HTTP</th>
<th>HTTPS</th>
<th>域名</th>
<th>IP</th>
</tr>
</thead>
<tbody>
<tr>
<td>net core gRPC客户端</td>
<td>x</td>
<td>√</td>
<td>√</td>
<td>√</td>
</tr>
<tr>
<td>net core gRPC客户端</td>
<td>√</td>
<td>x</td>
<td>x</td>
<td>√</td>
</tr>
</tbody>
</table>
<p>最最要命的是，在 win7 系统上，安装了 net core ，使用 Grpc.Net.ClientFactory 居然也不可以访问。在github上面找到了答案， <strong>win7 不会支持 http2</strong> ，并且 win7 微软已经在2020 年1 月14 日停止提供支持。</p>
<blockquote>
<p><a href="https://github.com/grpc/grpc-dotnet/issues/416#issuecomment-545596712">issues</a> : ASP.NET Core uses the operating system for HTTP/2 TLS support. macOS may support hosting servers with HTTP/2 TLS in the future, Windows 7 will not.</p>
</blockquote>
<h2 id="总结">总结</h2>
<p>这次WCF升级到 asp.net core + gRPC，迁移到 Linux 的部分，方案虽然可以运行。但是要<strong>放弃 win7 用户是不太可能的</strong>，只好放弃 gRPC这种方案。</p>
<p>幸运的是，放弃 gPRC 的那一刻，我突然意识到，<strong>为什么不用 web api</strong> ， RESTful 的方式也满足，逻辑部分的代码尽量不变。下一篇介绍，WCF 迁移到 asp.net core web api ，到目前为止，这个方案是我最为满意的。</p>
    </div>

    
    
<div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content">Long</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">
      2020-08-13 19:11
      
    </span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">许可协议</span>
    <span class="item-content">原创文章，如需转载请注明文章作者和出处。<br/><a rel="license noopener" href="https://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank">署名 4.0 国际 (CC BY 4.0)</a></span>
  </p>
</div>


    
    

    <footer class="post-footer">
      <div class="post-tags">
          <a href="https://mrbenwang.github.io/tags/net-core/">net core</a>
          <a href="https://mrbenwang.github.io/tags/grpc/">gRPC</a>
          
        </div>

      
      <nav class="post-nav">
        
          <a class="prev" href="/post/2020/20200814-wcf-to-aspnetcore-webapi/">
            
            <i class="iconfont">
              <svg  class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M691.908486 949.511495l75.369571-89.491197c10.963703-12.998035 10.285251-32.864502-1.499144-44.378743L479.499795 515.267417 757.434875 204.940602c11.338233-12.190647 11.035334-32.285311-0.638543-44.850487l-80.46666-86.564541c-11.680017-12.583596-30.356378-12.893658-41.662889-0.716314L257.233596 494.235404c-11.332093 12.183484-11.041474 32.266891 0.657986 44.844348l80.46666 86.564541c1.772366 1.910513 3.706415 3.533476 5.750981 4.877077l306.620399 321.703933C662.505829 963.726242 680.945807 962.528973 691.908486 949.511495z"></path>
</svg>

            </i>
            <span class="prev-text nav-default">*旧 WCF 项目成功迁移到 asp.net core web api</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        
          <a class="next" href="/post/2020/20200622-restructure-download/">
            <span class="next-text nav-default">*重构下载功能模块</span>
            <span class="prev-text nav-mobile">下一篇</span>
            
            <i class="iconfont">
              <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311 0.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889 0.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-0.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697C361.493148 60.273758 343.054193 61.470003 332.091514 74.487481z"></path>
</svg>

            </i>
          </a>
      </nav>
    </footer>
  </article>

  
  
  
  

  
  

  

  
  
    <div class="post bg-white">
      <script src="https://utteranc.es/client.js"
            repo= "MrBenWang/comments-for-my-blog"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
      </script>
    </div>
  

  

  

  

    

  

        </div>
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="icon-links">
  
  
    <a href="mailto:wzlblair@foxmail.com" rel="me noopener" class="iconfont"
      title="email" >
      <svg class="icon" viewBox="0 0 1451 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M664.781909 681.472759 0 97.881301C0 3.997201 71.046997 0 71.046997 0L474.477909 0 961.649408 0 1361.641813 0C1361.641813 0 1432.688811 3.997201 1432.688811 97.881301L771.345323 681.472759C771.345323 681.472759 764.482731 685.154773 753.594283 688.65053L753.594283 688.664858C741.602731 693.493018 729.424896 695.068979 718.077952 694.839748 706.731093 695.068979 694.553173 693.493018 682.561621 688.664858L682.561621 688.65053C671.644501 685.140446 664.781909 681.472759 664.781909 681.472759L664.781909 681.472759ZM718.063616 811.603883C693.779541 811.016482 658.879232 802.205449 619.10784 767.734955 542.989056 701.759633 0 212.052267 0 212.052267L0 942.809523C0 942.809523 0 1024 83.726336 1024L682.532949 1024 753.579947 1024 1348.948139 1024C1432.688811 1024 1432.688811 942.809523 1432.688811 942.809523L1432.688811 212.052267C1432.688811 212.052267 893.138176 701.759633 817.019477 767.734955 777.248 802.205449 742.347691 811.03081 718.063616 811.603883L718.063616 811.603883Z"></path>
</svg>

    </a>
  
    <a href="https://www.facebook.com/laowang.atlas/" rel="me noopener" class="iconfont"
      title="facebook"  target="_blank"
      >
      <svg class="icon" style="" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="33" height="33">
  <path d="M965.7344 2.7648c14.848 0 28.2624 5.5296 40.2432 16.6912C1017.9584 30.5152 1024 43.52 1024 58.2656l0 910.2336c0 14.848-6.0416 27.7504-18.0224 38.8096C993.8944 1018.4704 980.48 1024 965.7344 1024L704.9216 1024 704.9216 629.9648l133.2224 0 19.456-155.4432-152.576 0L705.024 373.0432c0-50.688 25.9072-76.0832 77.7216-76.0832l80.4864 0L863.232 163.5328c-27.7504-5.4272-67.4816-8.192-119.296-8.192-59.1872 0-106.8032 18.0224-142.9504 54.0672C564.736 245.5552 546.7136 296.0384 546.7136 360.7552l0 113.7664L413.4912 474.5216l0 155.4432 133.2224 0L546.7136 1024 55.5008 1024c-14.848 0-27.7504-5.5296-38.8096-16.6912C5.5296 996.2496 0 983.3472 0 968.4992L0 58.2656C0 43.52 5.5296 30.5152 16.6912 19.456c11.0592-11.0592 24.064-16.6912 38.8096-16.6912L965.7344 2.7648z"></path>
</svg>

    </a>
  
    <a href="https://github.com/MrBenWang" rel="me noopener" class="iconfont"
      title="github"  target="_blank"
      >
      <svg class="icon" style="" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M512 12.672c-282.88 0-512 229.248-512 512 0 226.261333 146.688 418.133333 350.08 485.76 25.6 4.821333 34.986667-11.008 34.986667-24.618667 0-12.16-0.426667-44.373333-0.64-87.04-142.421333 30.890667-172.458667-68.693333-172.458667-68.693333C188.672 770.986667 155.008 755.2 155.008 755.2c-46.378667-31.744 3.584-31.104 3.584-31.104 51.413333 3.584 78.421333 52.736 78.421333 52.736 45.653333 78.293333 119.850667 55.68 149.12 42.581333 4.608-33.109333 17.792-55.68 32.426667-68.48-113.706667-12.8-233.216-56.832-233.216-253.013333 0-55.893333 19.84-101.546667 52.693333-137.386667-5.76-12.928-23.04-64.981333 4.48-135.509333 0 0 42.88-13.738667 140.8 52.48 40.96-11.392 84.48-17.024 128-17.28 43.52 0.256 87.04 5.888 128 17.28 97.28-66.218667 140.16-52.48 140.16-52.48 27.52 70.528 10.24 122.581333 5.12 135.509333 32.64 35.84 52.48 81.493333 52.48 137.386667 0 196.693333-119.68 240-233.6 252.586667 17.92 15.36 34.56 46.762667 34.56 94.72 0 68.522667-0.64 123.562667-0.64 140.202666 0 13.44 8.96 29.44 35.2 24.32C877.44 942.592 1024 750.592 1024 524.672c0-282.752-229.248-512-512-512"></path>
</svg>

    </a>
  
    <a href="https://weibo.com/wzlblair" rel="me noopener" class="iconfont"
      title="weibo"  target="_blank"
      >
      <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M385.714286 733.714286q12-19.428571 6.285714-39.428571t-25.714286-28.571429q-19.428571-8-41.714286-0.571429t-34.285714 26.285714q-12.571429 19.428571-7.428571 39.142857t24.571429 28.857143 42.571429 1.428571 35.714286-27.142857zm53.714286-69.142857q4.571429-7.428571 2-15.142857t-10-10.571429q-8-2.857143-16.285714 2.857143t-12.285714 10.571429q-9.714286 17.714286 7.428571 25.714286 8 2.857143 16.571429 2.857143t12.571429-10.571429zm99.428571 61.142857q-25.714286 58.285714-90.285714 85.714286t-128 6.857143q-61.142857-19.428571-84.285714-72.285714t3.714286-107.142857q26.857143-53.142857 86.571429-79.428571t120.285714-10.857143q63.428571 16.571429 90.571429 68.285714t1.428571 108.857143zm178.285714-91.428571q-5.142857-54.857143-50.857143-97.142857t-119.142857-62.285714-156.857143-12q-127.428571 13.142857-211.142857 80.857143t-75.714286 151.142857q5.142857 54.857143 50.857143 97.142857t119.142857 62.285714 156.857143 12q127.428571-13.142857 211.142857-80.857143t75.714286-151.142857zm176 2.285714q0 38.857143-21.142857 79.714286t-62.285714 78.285714-96.285714 67.142857-129.142857 47.428571-154.571429 17.714286-157.142857-19.142857-137.428571-53.142857-98-86.285714-37.142857-114q0-65.714286 39.714286-140t112.857143-147.428571q96.571429-96.571429 195.142857-134.857143t140.857143 4q37.142857 36.571429 11.428571 119.428571-2.285714 8-0.571429 11.428571t5.714286 4 8.285714 2.857143 7.714286-2l3.428571-1.142857q79.428571-33.714286 140.571429-33.714286t87.428571 34.857143q25.714286 36 0 101.714286-1.142857 7.428571-2.571429 11.428571t2.571429 7.142857 6.857143 4.285714 9.714286 3.428571q32.571429 10.285714 58.857143 26.857143t45.714286 46.571429 19.428571 66.571429zm-42.285714-356.571429q24 26.857143 31.142857 62t-3.714286 67.142857q-4.571429 13.142857-16.857143 19.428571t-25.428571 2.285714q-13.142857-4.571429-19.428571-16.857143t-2.285714-25.428571q11.428571-36-13.714286-63.428571t-61.142857-20q-13.714286 2.857143-25.714286-4.571429t-14.285714-21.142857q-2.857143-13.714286 4.571429-25.428571t21.142857-14.571429q34.285714-7.428571 68 3.142857t57.714286 37.428571zm103.428571-93.142857q49.714286 54.857143 64.285714 127.142857t-7.714286 138q-5.142857 15.428571-19.428571 22.857143t-29.714286 2.285714-22.857143-19.428571-2.857143-29.714286q16-46.857143 5.714286-98.285714t-45.714286-90.285714q-35.428571-39.428571-84.571429-54.571429t-98.857143-4.857143q-16 3.428571-29.714286-5.428571t-17.142857-24.857143 5.428571-29.428571 24.857143-16.857143q70.285714-14.857143 139.428571 6.571429t118.857143 76.857143z"></path>
</svg>

    </a>
  
    <a href="https://www.instagram.com/mrbenwang/" rel="me noopener" class="iconfont"
      title="instagram"  target="_blank"
      >
      <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M853.333333 277.333333C853.333333 289.28 843.946667 298.666667 832 298.666667L746.666667 298.666667C734.72 298.666667 725.333333 289.28 725.333333 277.333333L725.333333 192C725.333333 180.053333 734.72 170.666667 746.666667 170.666667L832 170.666667C843.946667 170.666667 853.333333 180.053333 853.333333 192M192 853.333333C180.053333 853.333333 170.666667 843.946667 170.666667 832L170.666667 469.333333 259.84 469.333333C257.28 482.986667 256 497.493333 256 512 256 653.226667 370.773333 768 512 768 653.226667 768 768 653.226667 768 512 768 497.493333 766.293333 482.986667 764.16 469.333333L853.333333 469.333333 853.333333 832C853.333333 843.946667 843.946667 853.333333 832 853.333333M512 341.333333C606.293333 341.333333 682.666667 417.706667 682.666667 512 682.666667 606.293333 606.293333 682.666667 512 682.666667 417.706667 682.666667 341.333333 606.293333 341.333333 512 341.333333 417.706667 417.706667 341.333333 512 341.333333M853.333333 85.333333 170.666667 85.333333C123.306667 85.333333 85.333333 123.306667 85.333333 170.666667L85.333333 853.333333C85.333333 900.266667 123.733333 938.666667 170.666667 938.666667L853.333333 938.666667C900.266667 938.666667 938.666667 900.266667 938.666667 853.333333L938.666667 170.666667C938.666667 123.306667 900.266667 85.333333 853.333333 85.333333Z"></path>
</svg>

    </a>
  
    <a href="https://space.bilibili.com/344871908" rel="me noopener" class="iconfont"
      title="bilibili"  target="_blank"
      >
      <svg
  class="icon" style="" viewBox="0 0 1024 1024" version="1.1" width="36"
  height="36" id="svg8">
  <path
      style=""
      d="M 744.60599,0.00486267 A 41.779915,41.779915 0 0 0 710.4184,18.673394 L 548.5048,255.32642 h -11.70046 a 41.779915,41.779915 0 0 0 -10.80295,-7.84928 L 235.66,97.084498 a 41.779915,41.779915 0 0 0 -20.07193,-4.960864 41.779915,41.779915 0 0 0 -18.3748,79.145436 L 359.4859,255.32642 H 128.16909 c -49.458302,0 -89.27932,39.82105 -89.27932,89.27932 v 508.65224 c 0,49.4583 39.821018,89.27934 89.27932,89.27934 h 19.48445 C 149.12802,984.5043 179.92773,1024 224.79179,1024 c 44.86407,0 75.66379,-39.4957 77.13826,-81.46268 H 719.98116 C 721.45559,984.5043 752.25533,1024 797.1194,1024 c 44.86406,0 75.6638,-39.4957 77.13824,-81.46268 h 21.57323 c 49.45831,0 89.27936,-39.82104 89.27936,-89.27934 V 344.60574 c 0,-49.45827 -39.82105,-89.27932 -89.27936,-89.27932 H 649.74567 L 779.38103,65.866924 A 41.779915,41.779915 0 0 0 744.60599,0.00486267 Z M 644.49108,418.70871 c 6.29985,0.21538 12.44451,2.01107 17.86888,5.22196 l 171.36218,98.10771 c 18.23417,10.21935 24.63334,33.34627 14.24614,51.48533 -10.38726,18.13909 -33.57344,24.32718 -51.61587,13.77296 L 624.9903,489.18895 c -15.21356,-8.41858 -22.66871,-26.1765 -18.03211,-42.93436 4.63664,-16.75784 20.15573,-28.14465 37.53289,-27.54588 z M 350.2006,432.31846 c 16.89952,0.0317 31.69582,11.33328 36.17844,27.62747 4.48262,16.2942 -2.44981,33.57765 -16.95507,42.24898 l -140.7157,86.91312 c -17.68528,11.18244 -41.09629,5.77692 -52.08912,-12.02686 -10.99282,-17.80373 -5.33855,-41.15658 12.58167,-51.95857 L 329.9002,438.2095 c 6.0643,-3.86439 13.10951,-5.90891 20.3004,-5.89104 z M 501.605,641.53985 c 3.75002,-0.15248 7.48645,0.53903 10.93349,2.0235 0.15842,0.0637 0.31618,0.12888 0.47325,0.19582 0.59328,0.27092 1.17574,0.56489 1.74609,0.88121 0.15868,0.0854 0.31643,0.17233 0.47325,0.2611 0.55694,0.32165 1.10131,0.66458 1.63185,1.02807 0.16455,0.1123 0.32777,0.2265 0.48956,0.34269 0.50382,0.36781 0.99371,0.75428 1.46868,1.15864 0.18724,0.15504 0.37218,0.31282 0.55484,0.47323 0.43271,0.38784 0.8518,0.79061 1.25653,1.20756 0.15449,0.16114 0.30679,0.32437 0.45693,0.48959 0.40798,0.44266 0.79989,0.89988 1.17494,1.37076 0.17799,0.22544 0.35205,0.45395 0.5222,0.68538 0.25932,0.34701 0.50964,0.70071 0.75064,1.06071 0.26712,0.39516 0.52286,0.79784 0.76699,1.20757 0.16907,0.29043 0.33231,0.58424 0.48957,0.88123 0.21836,0.41297 0.42513,0.83199 0.62009,1.25653 0.14836,0.32333 0.28983,0.64976 0.42429,0.97911 0.21319,0.51552 0.40915,1.03801 0.58747,1.5666 0.0677,0.19499 0.13296,0.39085 0.19582,0.58748 0.18652,0.60823 0.34984,1.22334 0.48957,1.84399 0.0397,0.16277 0.0779,0.32601 0.11423,0.48957 0.1436,0.69112 0.25788,1.38801 0.34269,2.08877 0.005,0.0381 0.0111,0.0761 0.0163,0.11424 0.0857,0.78056 0.13474,1.56471 0.14687,2.34988 0.005,0.0543 0.0111,0.10879 0.0163,0.1632 0,0 -0.008,1.12132 0,1.45234 0,0 -0.14697,17.84761 5.89102,34.12231 3.01902,8.13734 7.33278,15.10615 12.61433,19.61501 5.28157,4.50889 11.42894,7.62081 23.64572,7.62081 12.2168,0 18.36416,-3.11192 23.64573,-7.62081 5.28154,-4.50886 9.5953,-11.47767 12.6143,-19.61501 6.03799,-16.2747 5.89103,-34.12231 5.89103,-34.12231 -0.44885,-13.87045 10.45922,-25.46302 24.3311,-25.86506 13.87189,-0.40201 25.42828,10.53953 25.78348,24.41272 0,0 1.11929,25.7226 -9.00791,53.01927 -5.06359,13.64832 -13.1986,28.46036 -27.05631,40.29073 -13.85772,11.83039 -33.5454,19.63135 -56.20142,19.63135 -22.65603,0 -42.34371,-7.80096 -56.20141,-19.63135 -4.1801,-3.56856 -7.78733,-7.42433 -10.99878,-11.42303 -3.21235,4.00037 -6.81703,7.85309 -10.99876,11.42303 -13.85773,11.83039 -33.5454,19.63135 -56.20144,19.63135 -22.65601,0 -42.3437,-7.80096 -56.2014,-19.63135 -13.85775,-11.83037 -21.99272,-26.64241 -27.05632,-40.29073 -10.12725,-27.29667 -9.00789,-53.01928 -9.00789,-53.01927 0.20714,-13.83687 11.58744,-24.88848 25.42444,-24.69013 14.1263,0.19991 25.2971,12.0278 24.69011,26.14247 0,0 -0.14697,17.84761 5.89103,34.12231 3.01902,8.13734 7.31646,15.10615 12.598,19.61501 5.28155,4.50889 11.44526,7.62081 23.66203,7.62081 12.21681,0 18.36418,-3.11192 23.64573,-7.62081 5.28154,-4.50886 9.57899,-11.47767 12.598,-19.61501 5.76352,-15.53489 5.89112,-32.05691 5.89103,-33.56746 0.006,-0.37466 0.0111,-1.05336 0.0163,-1.20759 -0.0117,-0.74583 0.0105,-1.49177 0.0652,-2.23565 0.009,-0.15784 0.0204,-0.31561 0.0327,-0.47324 0.14204,-1.56859 0.43163,-3.12027 0.86487,-4.63449 0.0213,-0.0763 0.0433,-0.15244 0.0652,-0.22848 3.0335,-10.25748 12.24157,-17.46007 22.92769,-17.93417 z"
      id="rect824"/>
</svg>

    </a>


<a href="https://mrbenwang.github.io/index.xml" rel="noopener alternate" type="application/rss&#43;xml"
    class="iconfont" title="rss" target="_blank">
    <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="30" height="30">
  <path d="M819.157333 1024C819.157333 574.592 449.408 204.8 0 204.8V0c561.706667 0 1024 462.293333 1024 1024h-204.842667zM140.416 743.04a140.8 140.8 0 0 1 140.501333 140.586667A140.928 140.928 0 0 1 140.074667 1024C62.72 1024 0 961.109333 0 883.626667s62.933333-140.544 140.416-140.586667zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667V345.173333c372.352 0 678.784 306.517333 678.784 678.826667z"></path>
</svg>

  </a>
   
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - <a class="theme-link" href="https://github.com/xianmin/hugo-theme-jane">Jane</a>
  </span>

  <span class="copyright-year">
    &copy;
    
      2007 -
    2020
    <span class="heart">
      
      <i class="iconfont">
        <svg class="icon" viewBox="0 0 1025 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="14" height="14">
  <path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7 0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1 0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2 0.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2 0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3 0.1-42.5-8-83.6-24-122.2z"
   fill="#8a8a8a"></path>
</svg>

      </i>
    </span><span class="author">
        Long
        
      </span></span>

  
  

  
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont">
        
        <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="35" height="35">
  <path d="M510.866688 227.694839 95.449397 629.218702l235.761562 0-2.057869 328.796468 362.40389 0L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777l894.052392 0 0 131.813095L63.840492 195.775872 63.840492 63.962777 63.840492 63.962777zM63.840492 63.962777"></path>
</svg>

      </i>
    </div>
  </div>
  
<script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>




<script type="text/javascript" src="/js/main.dee43230127a73d039a734510fa896c89c3c7ce0cf0be0c7a7433f8fd69b76dc.js" integrity="sha256-3uQyMBJ6c9A5pzRRD6iWyJw8fODPC&#43;DHp0M/j9abdtw=" crossorigin="anonymous"></script>






<script id="baidu_analytics">
  var _hmt = _hmt || [];
  (function() {
    if (window.location.hostname === 'localhost') return;
    var hm = document.createElement("script"); hm.async = true;
    hm.src = "https://hm.baidu.com/hm.js?aa3ed9f94f89c971ad305e8796039253";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
  })();
</script>





  
    <script type="text/javascript" src="/js/load-photoswipe.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe.min.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe-ui-default.min.js"></script>
  











  <script>
    $("#openSearch, #openSearchMobile").click(function(){
      $(".modal-dialog").addClass("visible");
    });

    $("#closeSearch").click(function(){
      $(".modal-dialog").removeClass("visible");
    });

    $(document).click(function(event) {
    
      if (!$(event.target).closest(".modal-content, #openSearch, #openSearchMobile").length) {
        $("body").find(".modal-dialog").removeClass("visible");
      }
    });
  </script>




  <script src="/js/custom.js"></script>


</body>
</html>
